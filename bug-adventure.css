/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Nunito', sans-serif;
    overflow: hidden; /* Prevent scrolling */
    background-color: #1a2b40;
    color: #fff;
    height: 100vh;
    width: 100vw;
    position: fixed; /* Ensure no bouncing/scrolling on mobile */
}

/* Game container - parent of all scene elements */
.game-container {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    overflow: hidden;
}

/* Scene with proper aspect ratio */
.scene {
    position: absolute;
    width: 100%;
    height: 100%;
    /* This ensures all scene content maintains a 1200:800 aspect ratio */
    aspect-ratio: 3/2;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    max-height: 100vh;
    max-width: 100vw;
}

/* Scene layers maintain aspect ratio */
.scene-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
    background-repeat: no-repeat;
    background-position: center bottom;
    /* Use cover to ensure content fills space without squishing */
    background-size: cover;
}

/* Place all layers with specific z-index values for proper stacking */
.sky-layer {
    z-index: 1;
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
}

/* Day sky gradient that's initially visible */
.sky-day {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: linear-gradient(to bottom, 
                #2d3f58 0%, 
                #596a82 30%, 
                #9a8178 60%, 
                #e6b58a 80%, 
                #f7d19e 100%);
    opacity: 1;
    transition: opacity 180s ease-in-out; /* 2-minute transition for opacity */
}

/* Night sky gradient that fades in */
.sky-night {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: linear-gradient(to bottom, 
                #0a0c10 0%, 
                #0a1a32 30%, 
                #4a312a 60%, 
                #96653a 80%, 
                #a7814e 100%);
    opacity: 0;
    transition: opacity 180s ease-in-out; /* 2-minute transition for opacity */
}

/* When the night class is added, day fades out and night fades in */
.sky-layer.night .sky-day {
    opacity: 0;
}

.sky-layer.night .sky-night {
    opacity: 1;
}

/* Stars layer with radial gradients */
.stars-layer {
    position: absolute;
    width: 100%;
    height: 100%; /* Cover the entire scene height */
    top: 0;
    left: 0;
    background-color: transparent; /* Start with a transparent background */
    /* No animation of background-image, set it all directly here */
    background-image: 
        /* Large bright stars */
        radial-gradient(circle, rgba(255, 255, 255, 0.9) 1px, transparent 1px),
        radial-gradient(circle, rgba(255, 255, 255, 0.8) 1px, transparent 1px),
        /* Medium stars */
        radial-gradient(circle, rgba(255, 255, 255, 0.7) 0.8px, transparent 0.8px),
        radial-gradient(circle, rgba(255, 255, 255, 0.6) 0.8px, transparent 0.8px),
        /* Small stars */
        radial-gradient(circle, rgba(255, 255, 255, 0.7) 0.5px, transparent 0.5px),
        radial-gradient(circle, rgba(255, 255, 255, 0.5) 0.5px, transparent 0.5px);
    
    /* Many different sizes to prevent patterns and ensure full coverage */
    background-size: 
        170px 170px, /* Large bright stars */
        190px 190px,
        130px 130px, /* Medium stars */
        110px 110px,
        80px 80px,   /* Small stars */
        70px 70px;
    
    /* Many different positions to ensure stars on the sides */
    background-position: 
        0px 0px, 
        90px 25px, 
        30px 45px, 
        60px 85px, 
        20px 10px, 
        50px 50px;
    
    z-index: 2;
    opacity: 0.8; /* Increased opacity (was 0.2) to make stars more visible */
    animation: starsBrightening 300s linear forwards;
    will-change: opacity; /* Only animate opacity, nothing else */
}

/* Shooting stars layer */
.shooting-stars-layer {
    position: absolute;
    width: 100%;
    height: 70%;
    top: 0;
    left: 0;
    z-index: 2;
    pointer-events: none;
    overflow: visible;
}

.sun-layer { z-index: 3; }
.clouds-distant-layer { z-index: 4; }
.clouds-layer { z-index: 5; }
.mountains-far-layer { z-index: 6; }
.mountains-far-mid-layer { z-index: 7; }
.mountains-near-layer { z-index: 8; }
.mountains-mid-near-layer { z-index: 9; }
.fog-layer { z-index: 10; }
.forest-midground-layer { z-index: 11; }
.ground-layer { z-index: 12; }
.forest-foreground-layer { z-index: 13; }

/* Sun element - with smoother animation */
.sun-layer::after {
    content: '';
    position: absolute;
    width: 80px;
    height: 80px;
    background: #ffe69c;
    border-radius: 50%;
    left: 55%;
    top: 30%; 
    box-shadow: 0 0 80px 20px rgba(255, 207, 124, 0.8);
    filter: blur(4px);
    animation: sunSet 180s linear forwards;
    will-change: opacity, background, box-shadow, top;
    z-index: 4; /* Ensure sun is behind mountains but in front of sky */
}

/* Sun fading animation - smoother transitions */
@keyframes sunSet {
    0% {
        opacity: 1;
        background: #ffe69c;
        box-shadow: 0 0 80px 20px rgba(255, 207, 124, 0.8);
        top: 30%;
    }
    20% {
        opacity: 0.9;
        background: #ffe09a;
        box-shadow: 0 0 75px 18px rgba(250, 202, 119, 0.75);
        top: 45%;
    }
    40% {
        opacity: 0.8;
        background: #ffd68c;
        box-shadow: 0 0 70px 15px rgba(245, 197, 114, 0.7);
        top: 60%;
    }
    60% {
        opacity: 0.6;
        background: #ffce84;
        box-shadow: 0 0 65px 12px rgba(240, 192, 109, 0.6);
        top: 68%;
    }
    80% {
        opacity: 0.4;
        background: #ffc67c;
        box-shadow: 0 0 50px 8px rgba(235, 187, 104, 0.4);
        top: 73%;
    }
    100% {
        opacity: 0.25;
        background: #ffb66c;
        box-shadow: 0 0 40px 5px rgba(225, 177, 94, 0.3);
        top: 75%;
    }
}

/* Cloud container - now with multiple wispy clouds */
.clouds-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* Wispy, irregular main cloud */
.clouds-layer::before {
    content: '';
    position: absolute;
    top: 24%;
    left: 20%;
    width: 180px;
    height: 30px;
    background-color: rgba(255, 255, 255, 0.12);
    border-radius: 100% 80% 70% 90% / 80% 90% 60% 70%;
    transform: rotate(-5deg) scale(1.2, 0.6);
    filter: blur(15px);
    animation: cloudDrift 140s linear infinite;
    box-shadow: 
        60px -5px 40px 5px rgba(255, 255, 255, 0.09),
        140px 8px 50px 10px rgba(255, 255, 255, 0.07),
        250px -10px 60px 8px rgba(255, 255, 255, 0.1);
}

/* Second wispy formation */
.clouds-layer::after {
    content: '';
    position: absolute;
    top: 15%;
    right: 30%;
    width: 200px;
    height: 20px;
    background-color: rgba(255, 255, 255, 0.08);
    border-radius: 90% 75% 85% 80% / 70% 80% 90% 85%;
    transform: rotate(3deg) scale(1.5, 0.5);
    filter: blur(18px);
    animation: cloudDrift 180s linear infinite reverse;
    box-shadow: 
        -80px 15px 70px 15px rgba(255, 255, 255, 0.06),
        -200px -10px 80px 20px rgba(255, 255, 255, 0.04);
}

/* Additional cloud element 1 */
.clouds-layer .additional-cloud-1 {
    content: '';
    position: absolute;
    top: 28%;
    left: 55%;
    width: 220px;
    height: 25px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 85% 95% 75% 65% / 75% 85% 90% 80%;
    transform: rotate(2deg) scale(1.4, 0.55);
    filter: blur(16px);
    animation: cloudDrift 160s linear infinite 30s;
    box-shadow: 
        -100px 10px 60px 12px rgba(255, 255, 255, 0.07),
        -230px -5px 70px 15px rgba(255, 255, 255, 0.05);
}

/* Additional cloud element 2 */
.clouds-layer .additional-cloud-2 {
    content: '';
    position: absolute;
    top: 20%;
    left: 75%;
    width: 190px;
    height: 18px;
    background-color: rgba(255, 255, 255, 0.09);
    border-radius: 70% 90% 80% 75% / 90% 75% 80% 85%;
    transform: rotate(-4deg) scale(1.3, 0.45);
    filter: blur(17px);
    animation: cloudDrift 190s linear infinite 75s;
    box-shadow: 
        70px 15px 55px 10px rgba(255, 255, 255, 0.06),
        -90px -10px 65px 15px rgba(255, 255, 255, 0.08);
}

/* Update cloud drift animation to not use transform with translateZ */
@keyframes cloudDrift {
    0% {
        transform: translateX(0) translateY(0) rotate(-5deg) scale(1.2, 0.6);
    }
    25% {
        transform: translateX(-150px) translateY(10px) rotate(-3deg) scale(1.3, 0.55);
    }
    50% {
        transform: translateX(-300px) translateY(5px) rotate(-6deg) scale(1.15, 0.65);
    }
    75% {
        transform: translateX(-150px) translateY(-5px) rotate(-4deg) scale(1.25, 0.6);
    }
    100% {
        transform: translateX(0) translateY(0) rotate(-5deg) scale(1.2, 0.6);
    }
}

/* Distant cloud layer - more diffuse and irregular */
.clouds-distant-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.clouds-distant-layer::before {
    content: '';
    position: absolute;
    top: 18%;
    left: 35%;
    width: 250px;
    height: 15px;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 85% 75% 90% 80% / 90% 80% 70% 85%;
    transform: rotate(2deg) scale(2, 0.4);
    filter: blur(20px);
    animation: distantCloudDrift 220s linear infinite;
    box-shadow: 
        120px 20px 100px 25px rgba(255, 255, 255, 0.03),
        -150px -15px 90px 20px rgba(255, 255, 255, 0.04);
}

.clouds-distant-layer::after {
    content: '';
    position: absolute;
    top: 10%;
    right: 25%;
    width: 300px;
    height: 10px;
    background-color: rgba(255, 255, 255, 0.04);
    border-radius: 80% 90% 70% 85% / 85% 70% 90% 75%;
    transform: rotate(-3deg) scale(1.8, 0.3);
    filter: blur(22px);
    animation: distantCloudDrift 260s linear infinite reverse;
}

@keyframes distantCloudDrift {
    0% {
        transform: translateX(0) translateY(0) rotate(2deg) scale(2, 0.4);
    }
    33% {
        transform: translateX(-200px) translateY(15px) rotate(3deg) scale(1.9, 0.45);
    }
    66% {
        transform: translateX(-400px) translateY(5px) rotate(1deg) scale(2.1, 0.35);
    }
    100% {
        transform: translateX(0) translateY(0) rotate(2deg) scale(2, 0.4);
    }
}

/* Fog layer - horizontal atmospheric gradient with softer transitions */
.fog-layer {
    position: absolute;
    width: 110%; /* Extend beyond screen edges */
    height: 70%; /* Increase height for more coverage */
    top: 15%;
    left: -5%; /* Negative offset to prevent edge visibility */
    background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.02) 10%,
        rgba(255, 255, 255, 0.04) 20%,
        rgba(255, 255, 255, 0.06) 30%,
        rgba(255, 255, 255, 0.08) 40%,
        rgba(255, 255, 255, 0.08) 60%,
        rgba(255, 255, 255, 0.06) 70%,
        rgba(255, 255, 255, 0.04) 80%,
        rgba(255, 255, 255, 0.02) 90%,
        rgba(255, 255, 255, 0) 100%
    );
    opacity: 0.2;
    filter: blur(20px);
    pointer-events: none;
}

/* Additional horizontal fog bands for more depth */
.fog-layer::before {
    content: '';
    position: absolute;
    width: 120%;
    height: 120%;
    top: -10%;
    left: -10%;
    background: radial-gradient(
        ellipse at center,
        rgba(255, 255, 255, 0.06) 0%,
        rgba(255, 255, 255, 0.04) 30%,
        rgba(255, 255, 255, 0.02) 60%,
        rgba(255, 255, 255, 0) 100%
    );
    filter: blur(25px);
    opacity: 0.3;
}

/* Far mountains - highly asymmetrical design */
.mountains-far-layer {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" preserveAspectRatio="none"><path d="M0,300 L0,220 L100,190 L200,220 L240,205 L300,230 L380,165 L450,190 L520,140 L600,190 L700,230 L750,160 L820,190 L900,220 L1000,180 L1080,200 L1150,140 L1200,170 L1200,300 Z" fill="%23534f55"/></svg>');
    background-size: 120% 100%;
    opacity: 1;
    transform: translateX(-12%); /* Moved further back */
    filter: blur(3px);
}

/* Extra far-mid mountain layer */
.mountains-far-mid-layer {
    position: absolute;
    width: 120%;
    height: 120%;
    top: -10%;
    left: -10%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" preserveAspectRatio="none"><path d="M0,300 L0,235 L70,215 L130,235 L180,205 L220,235 L290,195 L350,215 L430,185 L490,215 L550,195 L620,215 L720,175 L820,205 L900,185 L980,215 L1050,195 L1120,215 L1200,195 L1200,300 Z" fill="%23635c5f"/></svg>');
    background-size: 130% 100%;
    background-repeat: repeat-x;
    z-index: 2.25;
    transform: translateX(5%); /* Positioned between far and middle */
    filter: blur(2.5px);
    will-change: transform;
    transition: transform 0.1s ease-out;
}

/* Middle mountains - asymmetrical with offset peaks */
.mountains-near-layer {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" preserveAspectRatio="none"><path d="M0,300 L0,230 L45,220 L65,225 L80,210 L95,215 L120,220 L150,230 L180,225 L215,210 L250,190 L270,200 L300,230 L330,220 L350,215 L380,210 L410,220 L450,230 L480,225 L510,215 L550,180 L590,190 L620,200 L650,210 L690,200 L715,190 L780,180 L810,190 L850,215 L900,200 L935,185 L970,175 L1000,190 L1050,210 L1090,200 L1150,190 L1200,210 L1200,300 Z" fill="%23736b67"/></svg>');
    background-size: 130% 100%;
    bottom: 0;
    transform: translateX(18%); /* Adjusted position */
    filter: blur(1.5px);
}

/* Horizon fog bank - more subtle */
.fog-layer {
    position: relative;
    background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0) 30%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0.15) 60%,
        rgba(255, 255, 255, 0) 70%
    );
    opacity: 0.6;
    filter: blur(12px);
}

/* Reset media queries - we'll use a different approach */
@media (max-width: 1200px) {
    /* No specific overrides needed - our aspect ratio approach handles this */
}

@media (min-width: 1201px) {
    /* No specific overrides needed - our aspect ratio approach handles this */
}

/* Foreground with a few tall pine trees - adjusted for smaller ground */
.forest-foreground-layer {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" preserveAspectRatio="xMidYMax slice"><path d="M0,300 L0,275 Q200,260 400,275 Q600,255 800,275 Q1000,260 1200,275 L1200,300 Z" fill="%23164020"/><path d="M560,300 L560,260 L540,200 L520,260 L560,260 Z M660,300 L660,270 L640,180 L620,270 L660,270 Z M500,300 L500,255 L480,165 L460,255 L500,255 Z M710,300 L710,262 L690,202 L670,262 L710,262 Z" fill="%230f2a18"/><rect x="535" y="260" width="8" height="20" fill="%23412718"/><rect x="635" y="270" width="8" height="20" fill="%23412718"/><rect x="475" y="255" width="8" height="20" fill="%23412718"/><rect x="685" y="262" width="8" height="20" fill="%23412718"/><path d="M540,100 L525,130 L532,130 L517,160 L527,160 L510,190 L525,190 L505,220 L520,220 L505,220 L530,220 L552,220 L575,220 L555,190 L570,190 L548,160 L560,160 L545,130 L552,130 Z" fill="%23091d12"/><rect x="537" y="220" width="12" height="60" fill="%23412718"/><path d="M810,155 L795,185 L802,185 L787,215 L797,215 L780,245 L795,245 L775,275 L790,275 L775,275 L802,275 L818,275 L845,275 L825,245 L840,245 L820,215 L830,215 L815,185 L822,185 Z" fill="%23091d12"/><rect x="807" y="275" width="10" height="15" fill="%23412718"/><path d="M410,170 L400,200 L405,200 L393,230 L400,230 L390,260 L397,260 L390,260 L403,260 L417,260 L430,260 L420,230 L427,230 L415,200 L420,200 Z" fill="%23102315"/><rect x="407" y="260" width="10" height="30" fill="%23412718"/></svg>');
    bottom: 0;
    transform: translateZ(-1px);
}

/* Midground with more trees */
.forest-midground-layer {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 300" preserveAspectRatio="xMidYMax slice"><path d="M0,300 L0,275 Q200,260 400,275 Q600,260 800,275 Q1000,260 1200,275 L1200,300 Z" fill="%23173516" /><path d="M417,300 L417,258 L400,218 L383,258 L417,258 Z M467,290 L467,260 L450,210 L433,260 L467,260 Z M517,310 L517,272 L500,212 L483,272 L517,272 Z M567,285 L567,245 L550,200 L533,245 L567,245 Z M617,300 L617,268 L600,203 L583,268 L617,268 Z" fill="%23162c14" /><rect x="398" y="258" width="4" height="42" fill="%23412718"/><rect x="448" y="260" width="4" height="30" fill="%23412718"/><rect x="498" y="272" width="4" height="38" fill="%23412718"/><rect x="548" y="245" width="4" height="40" fill="%23412718"/><rect x="598" y="268" width="4" height="32" fill="%23412718"/></svg>');
    bottom: 0;
    transform: translateZ(-3px) scale(1.4);
}